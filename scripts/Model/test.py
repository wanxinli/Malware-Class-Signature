from sklearn import tree
import sys
import csv
from time import time
import pickle
from sklearn.externals import joblib

def main(argv):
    x = []
    y = []
    with open('test_metrics.csv','rb') as f:
        reader = csv.reader(f)
            
        next(reader, None)
        for row in reader:
            row_data = []
            for i in row[1:]:
                row_data.append(i)
            x.append(row_data)



    clf = joblib.load('model.pkl')
    res1 = clf.predict_proba(x)
    res2 = clf.predict(x)
    #print len(res)
    #print res
    res_proba = res1.tolist()
    res_labels = res2.tolist()
    #print res_labels
    
    with open('test_predict.csv','wb') as f:
        writer = csv.writer(f)
        writer.writerows(res_proba)
    

    real_labels = []
    with open('test_target.csv','rb') as f:
        reader = csv.reader(f)
        
        for row in reader:
            for i in row[1:]:
                real_labels.append(i)
        next(reader, None)

    #print real_labels
    # calculate the precision
    count = 0
    for i in range(len(res_labels)):
        if res_labels[i] == real_labels[i]:
            count = count + 1
    acc = (count * 1.0)/ len(res_labels)
    print acc

    #writer.writerows(proba)

if __name__=='__main__':
    main(sys.argv[1:])
